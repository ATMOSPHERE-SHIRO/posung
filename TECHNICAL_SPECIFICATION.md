<!-- TECHNICAL_SPECIFICATION.md -->
# 기술 명세서 (Technical Specification)

본 문서는 '보성고등학교 카드게임 멘토링 프로젝트'의 기술적 아키텍처, 핵심 로직, 보안 정책을 정의합니다. 안정적이고 공정한 게임 환경 구축을 목표로 합니다.

## 1. 기술 스택 (Technology Stack)

| 구분 (Category) | 기술 (Technology) | 역할 (Role) |
| :--- | :--- | :--- |
| **Backend** | Python (Flask / FastAPI 등) | 게임 로직 처리, 상태 관리, API 서버 운영 |
| **Frontend** | HTML, CSS, JavaScript (JSX) | 게임 UI 렌더링, 사용자 입력 처리, 서버 통신 |
| **Real-time**| WebSockets (Optional) | 클라이언트와 서버 간의 실시간 상태 동기화 |
| **Authentication** | JWT (JSON Web Token) | 생성된 게임방에 대한 사용자 접근 권한 인증 |
| **Infrastructure** | Direct IP Hosting | 초기 개발 단계의 서버 호스팅 |

## 2. 시스템 아키텍처 (System Architecture)

### 2.1. 서버 중심 아키텍처 (Server-Authoritative Architecture)

본 게임은 **서버 중심 아키텍처**를 채택하여 모든 비정상적인 행위를 원천 차단합니다.

*   **상태 관리(State Management)**: 게임의 모든 핵심 데이터(플레이어의 손패, 아이템, 테이블 상태, 남은 덱 등)는 **오직 서버에만** 존재하며, 서버만이 이를 수정할 수 있는 권한을 가집니다.
*   **클라이언트 역할**: 클라이언트는 서버로부터 받은 데이터를 시각적으로 표시하고(View), 유저의 입력을 서버로 보내는(Request) 역할만을 수행합니다. 클라이언트가 임의로 데이터를 변경하는 것은 불가능하며, 모든 행동은 서버의 허가를 받아야 합니다.
*   **게임룸 관리**: 플레이어 매칭 성공 시, 고유 일련번호(UUID or Serial)를 가진 게임방을 생성합니다. 이후 해당 게임방에 대한 모든 요청은 헤더에 포함된 JWT를 통해 참여 자격을 검증합니다.

## 3. 핵심 로직 및 규칙 엔진 (Core Logic & Rules Engine)

### 3.1. 이벤트 처리: '스택(Stack)' 시스템

복잡한 아이템 상호작용의 논리적 충돌을 방지하기 위해 **스택(Stack)** 기반의 이벤트 처리 시스템을 도입합니다.

1.  **행동 선언**: 플레이어의 모든 행동(아이템 사용 등)은 즉시 발동되지 않고, 스택이라는 대기열에 쌓입니다.
2.  **대응 기회**: 상대방은 스택 최상단의 행동에 대해 `아이템 효과 무효화` 같은 대응 효과를 사용할 수 있습니다. 이 대응 행동은 스택의 더 위쪽에 쌓입니다.
3.  **역순 처리 (LIFO)**: 양측이 더 이상 행동을 추가하지 않으면, 스택의 **가장 위(가장 나중에 들어온 행동)부터** 순서대로 효과를 처리합니다.

**예시:**
```
[상대방의 대응: 효과 무효화]   <-- Step 3: 가장 먼저 처리되어 아래 행동을 무효화
[나의 행동: 카드 뺏기]       <-- Step 4: 무효화되어 효과가 발동하지 않음
```

### 3.2. 게임 페이즈(Phase)의 명확한 구분

턴의 모든 과정은 명확한 페이즈로 나뉘어 서버가 현재 상태를 정확히 인지하고 오류를 방지합니다.
*   **`START_PHASE`**: 턴 시작 및 자원 분배.
*   **`MAIN_PHASE`**: 플레이어의 행동 대기.
    *   `ACTION_DECLARED`: 행동 선언 및 스택 등록.
    *   `RESPONSE_WINDOW`: 상대방의 대응 대기.
    *   `RESOLUTION`: 스택 처리.
*   **`END_PHASE`**: 턴 종료 처리 및 턴 플레이어 전환.

### 3.3. 카드 상태(State) 및 위치(Zone) 관리

모든 카드는 명확한 위치 값을 가집니다: `DECK`, `HAND`, `TABLE`, `CONSUMED`. 모든 아이템 효과는 명시된 위치의 카드에만 작용하도록 설계하여 '손에 있는 카드를 버리는 효과가 테이블에 영향을 주는' 등의 논리적 오류를 방지합니다.

## 4. 보안 및 비정상 행위 방지 (Security & Anti-Abuse)

### 4.1. 서버 측 모든 행동 유효성 검사 (Server-Side Validation)

클라이언트의 모든 요청에 대해 서버는 아래 항목을 포함한 다단계 검증을 수행합니다.

1.  **턴 소유권(Turn Ownership)**: 현재 턴인 플레이어의 요청인가?
2.  **자원 보유(Resource Possession)**: 요청한 아이템/카드를 실제로 보유하고 있는가?
3.  **행동 규칙(Action Legality)**: 현재 페이즈에서 가능한 행동인가?
4.  **타겟 유효성(Target Validity)**: 행동의 대상이 규칙에 부합하는가?

### 4.2. API 요청 속도 제한 (API Rate Limiting)

DDOS 공격이나 매크로 사용을 방지하기 위해, 동일 IP/유저의 API 요청 횟수를 일정 시간 단위로 제한합니다.

### 4.3. 게임 로그 (Game Logging)

서버에서 처리된 모든 유효한 행동과 그 결과는 타임스탬프와 함께 로그로 기록됩니다. 이 로그는 양 플레이어에게 실시간으로 공유되어 게임의 투명성을 확보하고, 문제 발생 시 디버깅의 핵심 자료로 활용됩니다.
